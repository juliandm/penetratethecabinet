apiRevision: edurata.io/v1
name: enrich-wef-config
title: Enrich config
description: fetching with the wayback machine old articles of wef, adding to json and then uploading to s3
interface:
  inputs:
    properties:
      cursor:
        type: string
        title: cursor
        description: if to start from a specific element in the array
        default: 1730
steps:
  get-config:
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: etl/extract/download-s3
    dependencies:
      AWS_ACCESS_KEY_ID: ${secrets.AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${secrets.AWS_SECRET_ACCESS_KEY}
      bucket_name: wef-images
      files:
        - key: people.json
          as_json: true
        - key: cursor.json
          as_json: true
  enrich-people:
    cache: true
    source:
      repoUrl: https://github.com/juliandm/penetratethecabinet.git
      path: ./functions/scrape-people
      ref: master
    dependencies:
      file: ${get-config.files[0].path}
      cursor: ${get-config.files[1].path}
  upload-people:
    source:
      repoUrl: https://github.com/Edurata/edurata-functions.git
      path: etl/load/upload-s3
    dependencies:
      AWS_ACCESS_KEY_ID: ${secrets.AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${secrets.AWS_SECRET_ACCESS_KEY}
      bucket_name: wef-images
      files:
        - ${enrich-people.file}
        - ${enrich-people.cursor}
